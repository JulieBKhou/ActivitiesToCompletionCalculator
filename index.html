<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Activities to Completion Calculator - Edgenuity</title>
    <link rel="icon" type="image/x-icon" href="lflcslogo.jpeg">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tailwindcss/2.2.19/tailwind.min.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/tailwindcss/2.2.19/tailwind.min.css" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

    <style>
        .icon {
            display: inline-block;
            width: 20px;
            height: 20px;
            fill: currentColor;
        }
        .icon-lg {
            width: 32px;
            height: 32px;
        }
        .course-card {
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            padding: 16px;
            margin-bottom: 16px;
            background-color: #f7d272;
        }
        .course-card.has-data {
            border-color: #faf1ac;
            background-color: #f7d272;
        }
        .activity-group {
            background-color: #f3f4f6;
            padding: 12px;
            border-radius: 6px;
            margin-bottom: 8px;
        }
    </style>
</head>
<body class="bg-gray-100 min-h-screen py-8">
    <body style="background-image: linear-gradient(to right, #f2b183, #f7f197);">
    <div class="max-w-6xl mx-auto p-6 bg-white rounded-lg shadow-lg">
        <div class="flex items-center gap-3 mb-6">
            <img src="lflcslogo.jpeg" alt="Logo" class="w-6 h-6 object-contain rounded">
            <h1 class="text-2xl font-bold text-gray-800">Activities to Completion Calculator - Edgenuity</h1>
        </div>

        <!-- Instructions -->
        <div class="mb-8 p-4 bg-yellow-50 border-l-4 border-yellow-400 rounded-md">
            <h3 class="text-lg font-semibold text-yellow-800 mb-3">How to Use This Calculator</h3>
            <div class="text-sm text-yellow-700 space-y-3">
                <p><strong>Step 1:</strong> Log into Edgenuity and navigate to the "Manage Students" screen and find the student you'd like to address. Under the "Options" tab, click on  "Progress Report". This screen will give you their progress for all the courses they are currently enrolled in. Under each course are data sets (Quiz, Test, Assignment, etc.). We will use the numbers underneath these headers to populate the fields below.</p>
                
                <p><strong>Step 2:</strong> In this website, input the student's name and target completion date below. For each course, input the course name; to add more courses, select the "Add Course" button. In each course, fill out the data set, input the associated numbers with "Taken" and "Total" from the Edgenuity Progress Report.</p>
                
                <p><strong>Result:</strong> As you enter the data, the results will appear below and will update automatically. Results have personalized daily targets per day, as well as by course. The numbers shown are the amount of activities to complete daily throughout the weekdays, and automatically exclude US Holidays and school breaks. Press the "Save Results as PDF" to download the summaries as a PDF.</p>
            </div>
        </div>

        <!-- Student Name -->
        <div class="mb-6">
            <label class="block text-sm font-medium text-gray-700 mb-2">
                Student Name
            </label>
            <input
                type="text"
                id="studentName"
                class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-yellow-500"
                placeholder="Enter student name"
            />
        </div>

        <!-- Target Completion Date -->
        <div class="mb-6">
            <label class="block text-sm font-medium text-gray-700 mb-2">
                Target Completion Date *
            </label>
            <input
                type="date"
                id="endDate"
                class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-yellow-500"
            />
        </div>

        <!-- Courses Section -->
        <div class="mb-6">
            <h2 class="text-xl font-semibold text-gray-800 mb-4">Courses (up to 15)</h2>
            <div id="coursesContainer"></div>
            <button
                id="addCourseBtn"
                class="mt-4 px-4 py-2 bg-yellow-600 text-white rounded-md hover:bg-yellow-700 focus:outline-none focus:ring-2 focus:ring-yellow-500"
            >
                Add Course
            </button>
        </div>

        <!-- Results Section -->
        <div id="result" class="bg-gray-50 p-4 rounded-lg hidden"></div>

        <!-- PDF Export Section -->
        <div id="pdfExportSection" class="mt-6 text-center hidden">
          <button id="exportPdfBtn" class="px-6 py-3 bg-red-600 text-white font-semibold rounded-md hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-red-500 transition-colors">
          ðŸ“„ Save Results as PDF
          </button>
        </div>

        <!-- Made by Section -->
        <div>
            <p class="text-sm text-gray-600 font-body">
            <br><code>Developed by</code> <span class="font-semibold text-gradient">Julie Khou</span><br>
        </div>
        
</p>
    </div>

    <script>
        let courseCount = 0;
        let courseNumID = 0;
        const maxCourses = 15;
        let currentResults = null;

        // Get today's date and set as minimum for date input
        const today = new Date().toISOString().split('T')[0];
        document.getElementById('endDate').min = today;

        // School holidays with date ranges
        function getSchoolHolidays(year) {
            const holidays = [];
            
            // Fixed holidays
            holidays.push(`${year}-01-01`); // New Year's Day
            holidays.push(`${year}-02-12`); // Lincoln's Birthday
            holidays.push(`${year}-01-15`); // MLK Day (approximate)
            holidays.push(`${year}-02-19`); // Presidents Day (approximate)
            holidays.push(`${year}-05-27`); // Memorial Day (approximate)
            holidays.push(`${year}-07-04`); // Independence Day
            holidays.push(`${year}-09-02`); // Labor Day (approximate)
            holidays.push(`${year}-10-14`); // Columbus Day (approximate)
            holidays.push(`${year}-11-11`); // Veterans Day
            holidays.push(`${year}-11-28`); // Thanksgiving (approximate)
            holidays.push(`${year}-12-25`); // Christmas Day

            // School break periods
            // October 6-10
            for (let day = 6; day <= 10; day++) {
                holidays.push(`${year}-10-${day.toString().padStart(2, '0')}`);
            }
            
            // November 24-28
            for (let day = 24; day <= 28; day++) {
                holidays.push(`${year}-11-${day.toString().padStart(2, '0')}`);
            }
            
            // December 22 - January 6 (winter break spans years)
            for (let day = 22; day <= 31; day++) {
                holidays.push(`${year}-12-${day.toString().padStart(2, '0')}`);
            }
            for (let day = 1; day <= 6; day++) {
                holidays.push(`${year + 1}-01-${day.toString().padStart(2, '0')}`);
            }
            
            // March 23 - April 3 (spring break spans months)
            for (let day = 23; day <= 31; day++) {
                holidays.push(`${year}-03-${day.toString().padStart(2, '0')}`);
            }
            for (let day = 1; day <= 3; day++) {
                holidays.push(`${year}-04-${day.toString().padStart(2, '0')}`);
            }

            return holidays;
        }

        function isWeekday(date) {
            const day = date.getDay();
            return day >= 1 && day <= 5; // Monday = 1, Friday = 5
        }

        function isHoliday(date, holidays) {
            const dateString = date.toISOString().split('T')[0];
            return holidays.includes(dateString);
        }

        function countWorkdays(startDate, endDate, holidays) {
            let count = 0;
            const current = new Date(startDate);
            
            while (current <= endDate) {
                if (isWeekday(current) && !isHoliday(current, holidays)) {
                    count++;
                }
                current.setDate(current.getDate() + 1);
            }
            
            return count;
        }

        function createActivityInput(activityType, courseNum) {
            return `
                <div class="activity-group">
                    <h5 class="text-sm font-medium text-gray-700 mb-2">${activityType}</h5>
                    <div class="grid grid-cols-2 gap-2">
                        <div>
                            <label class="block text-xs text-gray-600 mb-1">Taken</label>
                            <input
                                type="number"
                                id="${activityType.toLowerCase().replace(/[^a-z]/g, '')}-taken-${courseNum}"
                                class="w-full px-2 py-1 text-sm border border-gray-300 rounded focus:outline-none focus:ring-1 focus:ring-yellow-500"
                                min="0"
                                placeholder="0"
                                onchange="updateCourseCard(${courseNum})"
                            />
                        </div>
                        <div>
                            <label class="block text-xs text-gray-600 mb-1">Total</label>
                            <input
                                type="number"
                                id="${activityType.toLowerCase().replace(/[^a-z]/g, '')}-total-${courseNum}"
                                class="w-full px-2 py-1 text-sm border border-gray-300 rounded focus:outline-none focus:ring-1 focus:ring-yellow-500"
                                min="0"
                                placeholder="0"
                                onchange="updateCourseCard(${courseNum})"
                            />
                        </div>
                    </div>
                </div>
            `;
        }

        function createCourseCard(courseNum) {
            const courseCard = document.createElement('div');
            courseCard.className = 'course-card';
            courseCard.id = `course-${courseNum}`;
            
            const activityTypes = ['Quiz', 'Test', 'Exam', 'Essay/Assignment', 'Lab/Project'];
            
            courseCard.innerHTML = `
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-lg font-medium text-gray-800">Course ${courseNum}</h3>
                    <button onclick="removeCourse(${courseNum})" class="text-red-600 hover:text-red-800 text-sm">Remove</button>
                </div>
                
                <div class="mb-4">
                    <label class="block text-sm font-medium text-gray-700 mb-2">Course Name</label>
                    <input
                        type="text"
                        id="courseName-${courseNum}"
                        class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-yellow-500"
                        placeholder="e.g., Environmental Science"
                        onchange="updateCourseCard(${courseNum})"
                    />
                </div>

                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3 mb-4">
                    ${activityTypes.map(type => createActivityInput(type, courseNum)).join('')}
                </div>

                <div class="bg-yellow-50 p-3 rounded-lg">
                    <div class="grid grid-cols-2 gap-4 text-center">
                        <div>
                            <div class="text-lg font-bold text-yellow-600" id="takenActivities-${courseNum}">0</div>
                            <div class="text-xs text-gray-600">Taken Activities</div>
                        </div>
                        <div>
                            <div class="text-lg font-bold text-green-600" id="totalActivities-${courseNum}">0</div>
                            <div class="text-xs text-gray-600">Total Activities</div>
                        </div>
                    </div>
                </div>
            `;
            
            return courseCard;
        }

        function calculateCourseTotal(courseNum) {
            const activityTypes = ['quiz', 'test', 'exam', 'essayassignment', 'labproject'];
            let totalActivities = 0;
            let takenActivities = 0;

            activityTypes.forEach(type => {
                const takenEl = document.getElementById(`${type}-taken-${courseNum}`);
                const totalEl = document.getElementById(`${type}-total-${courseNum}`);
                
                if (takenEl && totalEl) {
                    const taken = parseInt(takenEl.value) || 0;
                    const total = parseInt(totalEl.value) || 0;
                    
                    takenActivities += taken;
                    totalActivities += total;
                }
            });

            // Update the display
            document.getElementById(`totalActivities-${courseNum}`).textContent = totalActivities;
            document.getElementById(`takenActivities-${courseNum}`).textContent = takenActivities;

            return { total: totalActivities, taken: takenActivities };
        }

        function addCourse() {
            if (courseCount >= maxCourses) return;
            
            courseCount++;
            courseNumID++;
            const coursesContainer = document.getElementById('coursesContainer');
            const courseCard = createCourseCard(courseNumID);
            coursesContainer.appendChild(courseCard);
            
            if (courseCount >= maxCourses) {
                document.getElementById('addCourseBtn').style.display = 'none';
            }
            
            calculateActivities();
        }

        function removeCourse(courseNum) {
            const courseCard = document.getElementById(`course-${courseNum}`);
            if (courseCard) {
                courseCard.remove();
                courseCount--;
                if (courseCount < maxCourses) {
                    document.getElementById('addCourseBtn').style.display = 'block';
                }
            }
            calculateActivities();
        }

        function updateCourseCard(courseNum) {
            const courseCard = document.getElementById(`course-${courseNum}`);
            const courseName = document.getElementById(`courseName-${courseNum}`).value;
            
            // Calculate totals for this course
            const totals = calculateCourseTotal(courseNum);
            
            // Update card styling based on data
            if (courseName || totals.total > 0) {
                courseCard.classList.add('has-data');
            } else {
                courseCard.classList.remove('has-data');
            }
            
            calculateActivities();
        }

        function showError(message) {
            const resultDiv = document.getElementById('result');
            resultDiv.className = 'bg-gray-50 p-4 rounded-lg';
            resultDiv.innerHTML = `
                <div class="flex items-center gap-2 text-red-600">
                    <svg class="icon" viewBox="0 0 24 24">
                        <circle cx="12" cy="12" r="10"/>
                        <line x1="12" y1="8" x2="12" y2="12"/>
                        <line x1="12" y1="16" x2="12.01" y2="16"/>
                    </svg>
                    <span>${message}</span>
                </div>
            `;
            resultDiv.classList.remove('hidden');
            document.getElementById('pdfExportSection').classList.add('hidden');
            currentResults = null;
        }

        function showResults(data) {
            const resultDiv = document.getElementById('result');
            const studentName = document.getElementById('studentName').value;
            currentResults = { ...data, studentName };
            
            let coursesHtml = '';
            let totalRemaining = 0;
            let totaltaken = 0;
            let totalActivities = 0;
            
            data.courses.forEach(course => {
                totalRemaining += course.remaining;
                totaltaken += course.taken;
                totalActivities += course.total;
                
                const progressPercent = course.total > 0 && (course.taken < course.total) ? Math.round((course.taken / course.total) * 100) : 0;
                coursesHtml += `
                    <div class="bg-white p-4 rounded-lg border mb-3">
                        <h4 class="font-semibold text-gray-800 mb-3 text-transform: capitalize">${course.name}</h4>
                        <div class="grid grid-cols-2 md:grid-cols-4 gap-3 text-sm">
                            <div class="text-center">
                                <span class="text-gray-600 block">Taken</span>
                                <div class="text-lg font-bold text-yellow-600">${course.taken}</div>
                            </div>
                            <div class="text-center">
                                <span class="text-gray-600 block">Total</span>
                                <div class="text-lg font-bold text-green-800">${course.total}</div>
                            </div>
                            <div class="text-center">
                                <span class="text-gray-600 block">Remaining</span>
                                <div class="text-lg font-bold text-blue-600">${course.remaining}</div>
                            </div>
                            <div class="text-center">
                                <span class="text-gray-600 block">Per Day</span>
                                <div class="text-lg font-bold text-purple-600">${course.dailyTarget}</div>
                            </div>
                        </div>
                        <div class="mt-3 pt-2 border-t">
                            <div class="flex justify-between items-center">
                                <span class="text-sm text-gray-600">Progress:</span>
                                <span class="text-sm font-semibold text-yellow-600">${progressPercent}%</span>
                            </div>
                            <div class="w-full bg-gray-200 rounded-full h-2 mt-1">
                                <div class="bg-yellow-600 h-2 rounded-full" style="width: ${progressPercent}%"></div>
                            </div>
                        </div>
                    </div>
                `;
            });
            
            const overallProgress = totalActivities > 0 ? Math.round((totaltaken / totalActivities) * 100) : 0;
            const overallDailyTarget = totalRemaining > 0 ? Math.ceil(totalRemaining / data.workdays) : 0;
            
            resultDiv.className = 'bg-gray-50 p-4 rounded-lg';
            resultDiv.innerHTML = `
                <div class="space-y-4">
                    <div class="text-center">
                        <h3 class="text-xl font-bold text-gray-800 text-transform: capitalize">${studentName ? `Study Plan for ${studentName}` : 'Your Study Plan'}</h3>
                        <p class="text-gray-600">Target completion: ${data.endDate}</p>
                    </div>
                    
                    <!-- Overall Summary -->
                    <div class="bg-gradient-to-r from-blue-50 to-purple-50 p-4 rounded-lg border">
                        <h4 class="font-semibold text-gray-800 mb-3 text-center">Overall Summary</h4>
                        <div class="text-center">
                          <div class="text-4xl font-bold text-purple-800">${overallDailyTarget}</div>
                          <div class="text-l text-purple-600">${overallDailyTarget > 1 ? 'Activities per Day' : 'Activity per Day'}</div>
                      	</div>
                        <div class="grid grid-cols-2 md:grid-cols-5 gap-4 text-center">
                            <div>
                                <div class="text-2xl font-bold text-yellow-600">${totaltaken}</div>
                                <div class="text-xs text-yellow-600">Taken</div>
                            </div>
                            <div>
                                <div class="text-2xl font-bold text-green-800">${totalActivities}</div>
                                <div class="text-xs text-green-600">Total Activities</div>
                            </div>
                            <div>
                                <div class="text-2xl font-bold text-blue-600">${totalRemaining}</div>
                                <div class="text-xs text-gray-600">Remaining</div>
                            </div>
                            <div>
                                <div class="text-2xl font-bold text-orange-600">${data.workdays}</div>
                                <div class="text-xs text-gray-600">Workdays Left</div>
                            </div>
                        </div>
                        <div class="mt-4">
                            <div class="flex justify-between items-center mb-1">
                                <span class="text-sm text-gray-600">Overall Progress:</span>
                                <span class="text-sm font-semibold text-yellow-600">${overallProgress}%</span>
                            </div>
                            <div class="w-full bg-gray-200 rounded-full h-3">
                                <div class="bg-gradient-to-r from-yellow-500 to-yellow-600 h-3 rounded-full" style="width: ${overallProgress}%"></div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Individual Courses -->
                    <div>
                        <h4 class="font-semibold text-gray-800 mb-3">Course Breakdown</h4>
                        ${coursesHtml}
                    </div>
                    
                    <div class="text-xs text-gray-500 text-center border-t pt-3">
                        * Calculation excludes weekends and school holidays (Oct 6-10, Nov 24-28, Dec 22-Jan 6, Mar 23-Apr 3)<br>
                        * Activities include: Quizzes, Tests, Exams, Essays/Assignments, and Labs/Projects
                    </div>
                </div>
            `;
            resultDiv.classList.remove('hidden');

            document.getElementById('pdfExportSection').classList.remove('hidden');

        }

    function exportToPDF() {
        const resultsElement = document.getElementById('result');
        
        html2canvas(resultsElement, {
            scale: 2, // Higher quality
            useCORS: true,
            allowTaint: true
        }).then(canvas => {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            const studentName = currentResults.studentName || 'Student';
            
            const imgData = canvas.toDataURL('image/png');
            const imgWidth = 190; // PDF width minus margins
            const pageHeight = 280; // Letter page height
            const imgHeight = (canvas.height * imgWidth) / canvas.width;
            
            let heightLeft = imgHeight;
            let position = 10;
            
            // Add first page
            doc.addImage(imgData, 'PNG', 10, position, imgWidth, imgHeight);
            heightLeft -= pageHeight;
            
            // Add additional pages if needed
            while (heightLeft >= 0) {
                position = heightLeft - imgHeight;
                doc.addPage();
                doc.addImage(imgData, 'PNG', 10, position, imgWidth, imgHeight);
                heightLeft -= pageHeight;
            }
            
            // doc.save('Study_Plan_Visual.pdf');
            // position += 10;
            // doc.text('Generated by Edgenuity Activities Calculator - Developed by Julie Khou', 20, yPos);
            
            // Save the PDF
            const capitalizedName = studentName.split(' ').map(word => word.charAt(0).toUpperCase() + word.slice(1).toLowerCase()).join('');
            const filename = capitalizedName ? `${capitalizedName}StudyPlan.pdf` : 'StudyPlan.pdf';
            doc.save(filename);
        });
    }
        function calculateActivities() {
            const endDate = document.getElementById('endDate').value;
            
            if (!endDate) {
                document.getElementById('result').classList.add('hidden');
                return;
            }

            const courses = [];
            let hasValidCourse = false;

            // Collect course data
            for (let i = 1; i <= courseNumID; i++) {
                const courseElement = document.getElementById(`course-${i}`);
                if (!courseElement) continue;

                const courseName = document.getElementById(`courseName-${i}`)?.value || `Course ${i}`;
                const totals = calculateCourseTotal(i);

                if (totals.total > 0) {
                    hasValidCourse = true;
                    const remaining = Math.max(0, totals.total - totals.taken);

                    courses.push({
                        name: courseName,
                        total: totals.total,
                        taken: totals.taken,
                        remaining: remaining
                    });
                } else {
                    const capitalizedName = courseName.charAt(0).toUpperCase() + courseName.slice(1).toLowerCase();
                    showError(`Course total for ${capitalizedName} is 0`);
                    return;
                }
            }

            if (!hasValidCourse) {
                document.getElementById('result').classList.add('hidden');
                return;
            }

            const today = new Date();
            const targetDate = new Date(endDate);
            
            if (targetDate <= today) {
                showError("End date must be in the future");
                return;
            }

            // Check for taken > total
            const invalidCourses = courses.filter(course => course.taken > course.total);
            if (invalidCourses.length > 0) {
                const courseNames = invalidCourses.map(course => course.name.charAt(0).toUpperCase() + course.name.slice(1)).join(', ');
                showError(`Activities taken cannot be more than total activities. Please check: ${courseNames}`);
                return;
            }

            // Get holidays for current and next year
            const currentYear = today.getFullYear();
            const nextYear = targetDate.getFullYear();
            let holidays = getSchoolHolidays(currentYear);
            if (nextYear > currentYear) {
                holidays = holidays.concat(getSchoolHolidays(nextYear));
            }

            const workdays = countWorkdays(today, targetDate, holidays);
            
            if (workdays <= 0) {
                showError("No workdays available between now and the end date");
                return;
            }

            // Calculate daily targets for each course
            courses.forEach(course => {
                course.dailyTarget = course.remaining > 0 ? Math.ceil(course.remaining / workdays) : 0;
            });

            showResults({
                courses,
                workdays,
                endDate: targetDate.toLocaleDateString()
            });
        }

        // Event listeners
        document.getElementById('studentName').addEventListener('input', calculateActivities);
        document.getElementById('endDate').addEventListener('change', calculateActivities);
        document.getElementById('addCourseBtn').addEventListener('click', addCourse);
        document.getElementById('exportPdfBtn').addEventListener('click', exportToPDF);


        // Add initial course
        addCourse();
    </script>
</body>
</html>
